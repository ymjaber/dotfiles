general {
    gaps_in = 5
    gaps_out = 20

    border_size = 2

    col.active_border = rgba(33ccffee) rgba(00ff99ee) 45deg
    col.inactive_border = rgba(595959aa)

    resize_on_border = false
    extend_border_grab_area = 15

    allow_tearing = false

    layout = dwindle
}

dwindle {
    pseudotile = true
    preserve_split = true
    force_split = 2
    split_width_multiplier = 1.0
    smart_split = false
    smart_resizing = true
    use_active_for_splits = true
}

master {
    new_status = master
    new_on_top = false
    mfact = 0.55
    orientation = left
    special_scale_factor = 0.8
    allow_small_split = false
}

group {
    groupbar {
    }
}

# TODO: Refine and fix window rules for the new Hyprland version

# =============================================================================
# Floating Windows
# =============================================================================

# System utilities
windowrule = float true, match:class pavucontrol          # Audio control
windowrule = float true, match:class nm-connection-editor # Network settings
windowrule = float true, match:class blueman-manager      # Bluetooth manager
windowrule = float true, match:class gnome-calculator     # Calculator
windowrule = float true, match:class gnome-system-monitor # System monitor


# File dialogs and pickers
windowrule = float true, match:title Open File          # File open dialogs
windowrule = float true, match:title Save As            # Save dialogs
windowrule = float true, match:title Choose Files       # File choosers
windowrule = float true, match:title File Upload        # Browser uploads
windowrule = float true, match:class xdg-desktop-portal # Desktop portals

# Media and graphics
windowrule = float true, match:class imv
windowrule = float true, match:class mpv
windowrule = float true, match:class vlc
windowrule = float true, match:title Picture-in-Picture
windowrule = float true, match:title Volume Control
windowrule = float true, match:title pavucontrol
windowrule = float true, match:title nm-connection-editor
windowrule = float true, match:title blueman-manager

# Authentication and prompts
windowrule = float true, match:class polkit-gnome-authentication-agent-1 # Auth prompts
windowrule = float true, match:class gcr-prompter                        # Password prompts
windowrule = float true, match:class pinentry-                           # GPG password entry

# Messaging and communication
windowrule = float true, match:class telegram-desktop, match:title Media viewer # Telegram media

# =============================================================================
# WINDOW SIZING AND POSITIONING
# =============================================================================

# Center and size system utilities
windowrule = center true, match:class pavucontrol
windowrule = size 800 600, match:class pavucontrol

windowrule = center true, match:class blueman-manager
windowrule = size 900 600, match:class blueman-manager

windowrule = center true, match:class nm-connection-editor
windowrule = size 800 600, match:class nm-connection-editor

# Small utilities
windowrule = center true, match:class gnome-calculator
windowrule = size 400 500, match:class gnome-calculator

# File dialogs - reasonable default size
windowrule = center true, match:title Open File
windowrule = size 900 600, match:title Open File
windowrule = center true, match:title Save As
windowrule = size 900 600, match:title Save As

# TODO: fix

# Terminal floating window (when launched with float class)
windowrule = float true, match:class floating
windowrule = center true, match:class floating
windowrule = size (monitor_w*0.8) (monitor_h*0.8), match:class kitty

# Btop system monitor
windowrule = float true, match:title btop
windowrule = center true, match:title btop
windowrule = size 1200 800, match:title btop
windowrule = pin true, match:title btop

# =============================================================================
# Jetbrains IDEs
# =============================================================================

windowrule = match:class ^jetbrains-.*$, match:title ^($|\\s$|win\\d+$), match:float 1, no_initial_focus 1
windowrule = opacity 0.95 0.9 0.95, match:class jetbrains-.*

# =============================================================================
# Idle Inhibit Rules
# =============================================================================
# Prevent system from sleeping/screen from turning off

#TODO: fix

# Video players
# windowrule = idleinhibit fullscreen, match:class mpv
# windowrule = idleinhibit fullscreen, match:class vlc
# windowrule = idleinhibit fullscreen, match:class firefox

# Always prevent idle for specific apps
# windowrule = idleinhibit always, match:class steam_app    # Games
# windowrule = idleinhibit focus, match:class obs          # OBS Studio

# =============================================================================
# Special Behaviors
# =============================================================================

# TODO: fix

# Gaming and performance
# windowrule = fullscreen true, match:class steam_app       # Steam games start fullscreen
# windowrule = noblur true, match:class steam_app           # Disable blur for games
# windowrule = noshadow true, match:class steam_app         # Disable shadows for games
# windowrule = rounding 0, match:class steam_app       # No rounding for games

# Picture-in-Picture
# windowrule = float true, match:title Picture-in-Picture
# windowrule = pin true, match:title Picture-in-Picture
# windowrule = noborder true, match:title Picture-in-Picture
# windowrule = size 640 360, match:title Picture-in-Picture
# windowrule = move 100%-660 20, match:title Picture-in-Picture  # Top-right corner

# Screen sharing indicator
# windowrule = float true, match:title Firefox — Sharing Indicator
# windowrule = noborder, match:title Firefox — Sharing Indicator
# windowrule = noshadow, match:title Firefox — Sharing Indicator
# windowrule = nofocus, match:title Firefox — Sharing Indicator

# Jetbrains IDEs splash screens
# windowrule = noanim true, match:class jetbrains-, floating:1
# windowrule = noborder true, match:class jetbrains-, floating:1
# windowrule = center true, match:class jetbrains-, floating:1

# XWayland specific rules (for compatibility)
# windowrule = rounding 0, xwayland:1               # No rounding for X11 apps

# windowrule = nofocus,class:^$,title:^$,xwayland:1,floating:1,fullscreen:0,pinned:0

# =============================================================================
# LAYER RULES
# =============================================================================
# Control layer shell surfaces (panels, docks, etc.)

# Example for waybar (if not using its own layer config)
# layerrule = blur, waybar
# layerrule = ignorezero, waybar

# # Notification layer
# layerrule = blur, notifications
# layerrule = ignorezero, notifications
#
# # Application launcher
# layerrule = blur, wofi
# layerrule = blur, rofi
# layerrule = dimaround, wofi
# layerrule = dimaround, rofi

# TODO: review

windowrule {
    # Ignore maximize requests from all apps. You'll probably like this.
    name = suppress-maximize-events
    match:class = .*

    suppress_event = maximize
}

windowrule {
    # Fix some dragging issues with XWayland
    name = fix-xwayland-drags
    match:class = ^$
    match:title = ^$
    match:xwayland = true
    match:float = true
    match:fullscreen = false
    match:pin = false

    no_focus = true
}

# Hyprland-run windowrule
windowrule {
    name = move-hyprland-run

    match:class = hyprland-run

    move = 20 monitor_h-120
    float = yes
}

windowrule {
    name = transparent-terminal
    match:class = kitty
    opacity = 0.95 0.85 0.95
}

windowrule {
	name = shimeji
	match:class = com-group_finity-mascot-Main

	float = true
	no_blur = true
	no_focus = true
	no_shadow = true
	border_size = 0
}

######################################################################################
# NOTES AND DEBUGGING
######################################################################################
# To find window properties for creating rules:
# 1. Run: hyprctl clients
# 2. Look for: class, title, pid, xwayland status
# 3. Use regex for flexible matching: class:(firefox) matches any firefox window
# 4. Use ^ and $ for exact matching: class:^(firefox)$ matches exactly "firefox"
#
# Test rules:
# - Add rule to this file
# - Run: hyprctl reload
# - Open the application to see if rule applies
#
# Common issues:
# - XWayland apps may need different rules than Wayland apps
# - Some apps change their title/class after starting
# - Electron apps often have generic class names

